/*
react-json v0.0.1
https://github.com/arqex/react-json
MIT: https://github.com/arqex/react-json/raw/master/LICENSE
*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("React")):"function"==typeof define&&define.amd?define(["React"],e):"object"==typeof exports?exports.Json=e(require("React")):t.Json=e(t.React)}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n=r(1),i=r(12),s=r(11),o=r(2),a=r(3),u=r(4),p=r(5),c=r(6),h=r(7),f=r(8),l=r(9),d=r(10),g=n.createClass({getDefaultProps:function(){return{doc:{},errors:!1}},childContextTypes:{typeDefaults:n.PropTypes.object},getChildContext:function(){return{typeDefaults:this.state.defaults}},getInitialState:function(){var t=this,e=this.props.doc;return e.getListener||(e=new i(e).get()),e.getListener().on("update",function(e){t.setState({doc:e}),t.state.errors&&t.getValidationErrors()}),{doc:e,defaults:this.createDefaults()}},componentWillReceiveProps:function(t){t.doc.getListener||this.setState({doc:this.state.doc.reset(t.doc)}),this.setState({defaults:this.createDefaults()})},render:function(){var t=this.props.definition,e=n.createElement(o,{type:"object",value:this.state.doc,settings:s({},this.state.defaults.object,{properties:t.properties,editing:t.editing,extensible:t.extensible,header:!1,order:t.order}),ref:"doc",defaults:this.state.defaults});return n.DOM.div({className:"jsonEditor"},e)},getValue:function(){return this.state.doc.toJS()},getValidationErrors:function(){var t=this.getValue(),e=this.refs.doc.getValidationErrors(t);return this.setState({errors:e.length}),e.length?e:!1},getDeepSettings:function(){var t={};for(var e in d)t[e]=d[e](this,t[e]);return t},createDefaults:function(){var t=o.prototype.components,e=this.props.definition.defaults||{},r={};for(var n in t)r[n]=s({},t[n].prototype.defaults||{},e[n]||{});return r}});g.registerType=o.registerType.bind(o),g.registerType("object",a),g.registerType("array",u,!0),g.registerType("string",p,!0),g.registerType("text",f,!0),g.registerType("number",h,!0),g.registerType("boolean",c,!0),g.registerType("password",l,!0),t.exports=g},function(e,r,n){e.exports=t},function(t,e,r){"use strict";var n=r(1),i=r(10),s=r(11),o=n.createClass({components:{},typeCheckOrder:[],contextTypes:{typeDefaults:n.PropTypes.object},render:function(){var t=this.getComponent(),e=s({},this.context.typeDefaults[this.props.type],this.props.settings);return this.addDeepSettings(e),n.createElement(t,{value:this.props.value,settings:e,onUpdated:this.props.onUpdated,ref:"property"})},getComponent:function(){var t=this.props.type;return t||(t=this.guessType(this.props.value)),this.propertyType=t,this.components[t]},guessType:function(t){for(var e=!1,r=0,n=this.typeCheckOrder;!e&&r<n.length;)this.components[n[r]].prototype.isType(t)?e=n[r++]:r++;return e||"object"},getValidationErrors:function(t){return this.refs.property.getValidationErrors(t)},addDeepSettings:function(t){var e,r=this.props.parentSettings||{};for(var n in i)e=i[n](r[n],t[n]),"undefined"!=typeof e&&(t[n]=e)}});o.registerType=function(t,e,r){var n=o.prototype;n.components[t]=e,r&&n.typeCheckOrder.unshift(t)},t.exports=o},function(t,e,r){"use strict";var n=r(1),i=r(13),s=r(11),o=r(14),a=n.createClass({mixins:[o],getInitialState:function(){return this.getStateFromProps(this.props)},getStateFromProps:function(t){return{editing:t.settings.editing||!1,properties:s({},t.settings&&t.settings.properties||{})}},defaultValue:{},render:function(){{var t=this,e=this.props.settings,r=this.state.editing||e.header===!1?"open jsonObject jsonCompound":"jsonObject jsonCompound",i="",o=(this.state.properties,[]);s({},this.props.value)}this.getPropertyOrder().forEach(function(e){o.push(t.renderProperty(e))});var a=[o];return e.adder!==!1&&a.push(this.renderAdder()),i=n.DOM.div({key:"o",className:"jsonChildren"},a),n.DOM.span({className:r},[this.renderHeader(),i])},renderProperty:function(t){var e=this.props.value[t],r=this.state.properties[t]||{};return r.settings||(r.settings={}),n.createElement(i,{value:e,key:t,name:t,ref:t,definition:r,onUpdated:this.updateProperty,onDeleted:this.deleteProperty,parentSettings:this.props.settings})},getDefaultHeader:function(){return"Map ["+Object.keys(this.props.value)+"]"},getDefaultAdder:function(){return"+ Add property"},updateProperty:function(t,e){this.checkEditingSetting(t),this.props.value.set(t,e)},deleteProperty:function(t){this.props.value.remove(t)},getValidationErrors:function(t){var e=this,r=[],n=Object.keys(this.refs);return n.forEach(function(t){var n=e.refs[t].getValidationErrors();n&&(r=r.concat(n))}),r},getPropertyOrder:function(){var t=this.props.settings.order,e=typeof t;if(!t||"function"!=e&&t.constructor!==Array)return Object.keys(this.props.value);var r=s({},this.props.value),n=[];if("function"==e)return t(r);t.constructor===Array&&t.forEach(function(t){"undefined"!=typeof r[t]&&(n.push(t),delete r[t])});for(var i in r)-1==n.indexOf(i)&&n.push(i);return n}});t.exports=a},function(t,e,r){"use strict";var n=r(1),i=r(13),s=(r(11),r(14)),o=n.createClass({mixins:[s],getInitialState:function(){return this.getStateFromProps(this.props)},getStateFromProps:function(t){return{editing:t.settings.editing||!1,properties:this.state&&this.state.properties||{}}},defaultValue:[],render:function(){for(var t,e=this.props.settings,r=this.state.editing?"open jsonArray jsonCompound":"jsonArray jsonCompound",s="",o=this.state.properties,a=[],u=0;u<this.props.value.length;u++)t=o[u]||{},t.settings||(t.settings={}),a.push(n.createElement(i,{value:this.props.value[u],key:u,name:u,definition:t,onUpdated:this.updateProperty,onDeleted:this.deleteProperty,parentSettings:this.props.settings}));var p=[a];return e.adder!==!1&&p.push(this.renderAdder(this.props.value.length)),s=n.DOM.div({key:"o",className:"jsonChildren"},p),n.DOM.span({className:r},[this.renderHeader(),s])},getDefaultHeader:function(){return"List ["+this.props.value.length+"]"},getDefaultAdder:function(){return"+ Add element"},updateProperty:function(t,e){this.checkEditingSetting(t),this.props.value.set(t,e)},deleteProperty:function(t){var e={};for(var r in this.state.properties)r>t?e[r-1]=this.state.properties[r]:t>r&&(e[r]=this.state.properties[r]);this.props.value.splice(t,1),this.setState({properties:e})},isType:function(t){return t&&t.constructor==Array}});t.exports=o},function(t,e,r){var n=r(1),i=r(15),s=n.createClass({mixins:[i],typeClass:"jsonString",inputType:"text",defaultValue:"",getInitialState:function(){return this.getStateFromProps(this.props)},render:function(){return this.renderInput()},updateValue:function(t){this.setState({value:t.target.value})},isType:function(t){return"object"!=typeof t}});t.exports=s},function(t,e,r){var n=r(1),i=n.createClass({defaultValue:!1,render:function(){var t="jsonBoolean";return n.DOM.input({type:"checkbox",className:t,checked:this.props.value,onChange:this.updateValue})},setValue:function(){this.setState({editing:!1}),this.props.onUpdated(this.state.value)},updateValue:function(t){this.props.onUpdated(t.target.checked)},isType:function(t){return"boolean"==typeof t},componentWillReceiveProps:function(t){this.props.value!=t.value&&this.setState({value:t.value})}});t.exports=i},function(t,e,r){var n=r(1),i=r(15),s=n.createClass({mixins:[i],typeClass:"jsonNumber",inputType:"number",defaultValue:"",getInitialState:function(){return this.getStateFromProps(this.props)},render:function(){return this.renderInput()},updateValue:function(t){this.setState({value:parseFloat(t.target.value)})},isType:function(t){return"number"==typeof t}});t.exports=s},function(t,e,r){var n=r(1),i=r(15),s=n.createClass({mixins:[i],defaultValue:"",getInitialState:function(){return this.getStateFromProps(this.props)},render:function(){var t="jsonText";return this.state.editing?n.DOM.textarea({value:this.state.value,onChange:this.updateValue,placeholder:this.props.settings.placeholder||"",onBlur:this.setValue,ref:"input"}):n.DOM.span({onClick:this.setEditMode,className:t},this.props.value)},updateValue:function(t){this.setState({value:t.target.value})},isType:function(t){return"string"==typeof t&&t.length>100}});t.exports=s},function(t,e,r){var n=r(1),i=r(15),s=n.createClass({mixins:[i],typeClass:"jsonPassword",inputType:"password",defaultValue:"",getInitialState:function(){return this.getStateFromProps(this.props)},render:function(){return this.renderInput()},getDisplayModeString:function(){return this.getWildcards()},getWildcards:function(){for(var t="",e=this.state.value.length-1;e>=0;e--)t+="*";return t},isType:function(){return!1},updateValue:function(t){this.setState({value:t.target.value})}});t.exports=s},function(t,e,r){t.exports={editing:function(t,e){return"undefined"!=typeof e?e:"always"==t?"always":void 0},adder:function(t,e){return"undefined"!=typeof e?e:"undefined"!=typeof t?t:!0}}},function(t,e,r){"use strict";function n(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=Object.assign||function(t,e){for(var r,i,s=n(t),o=1;o<arguments.length;o++){r=arguments[o],i=Object.keys(Object(r));for(var a=0;a<i.length;a++)s[i[a]]=r[i[a]]}return s}},function(t,e,r){var n=r(16);t.exports=n},function(t,e,r){"use strict";var n=r(1),i=r(11),s=r(17),o=r(2),a=n.createClass({getInitialState:function(){return{error:!1}},getDefaultProps:function(){return{definition:{}}},render:function(){var t=this.props.definition||{},e="jsonProperty",r=t.type||o.prototype.guessType(this.props.value),i=this.renderTypeProperty(r),s="";return e+=" "+r+"Property",this.state.error&&(e+=" jsonError",s=n.DOM.span({key:"e",className:"jsonErrorMsg"},this.state.error)),n.DOM.div({className:e},[n.DOM.span({className:"jsonName",key:"n"},[n.DOM.a({key:"a",href:"#",className:"jsonRemove",onClick:this.handleRemove},"x"),n.DOM.span({key:"s1"},(t.title||this.props.name)+":")]),n.DOM.span({className:"jsonValue",key:"v"},[n.DOM.span({key:"s2"},i)]),s])},renderTypeProperty:function(t){var e,r=this.props.definition||{},s=i({},r.settings||{});return r.properties&&(s.properties=r.properties),e=n.createElement(o,{type:t,value:this.props.value,settings:s,onUpdated:this.onUpdated,ref:"typeProperty",parentSettings:this.props.parentSettings})},handleRemove:function(t){this.props.onDeleted(this.props.name)},shouldComponentUpdate:function(t,e){return t.value!=this.props.value||e.error!=this.state.error},onUpdated:function(t){this.props.onUpdated(this.props.name,t)},getValidationErrors:function(t){var e=[],r=this.props.definition.validates,n=this.props.name,i=this.refs.typeProperty;if("object"==i.propertyType&&(e=i.getValidationErrors(t),e.forEach(function(t){t.path=t.path?n+"."+t.path:n})),!r)return e;var o,a=s.getValidationError(this.props.value,t,r);return a?(o=this.props.definition.errorMessage,o||(o=(this.props.definition.title||this.props.name)+" value is not valid."),a.path=n,a.message=o,this.setState({error:o}),e=e.concat([a])):this.state.error&&this.setState({error:!1}),e}});t.exports=a},function(t,e,r){"use strict";var n=r(1),i=r(18),s=r(11);t.exports={renderHeader:function(){var t=this.props.settings.header;if(t===!1)return"";var e,r=typeof t;return e="function"==r?t(this.props.value.toJS()):"undefined"==r?this.getDefaultHeader():t,n.DOM.span({key:"s",onClick:this.toggleEditing,className:"compoundToggle"},e)},toggleEditing:function(){"always"!=this.state.editing&&this.props.settings.header!==!1&&this.setState({editing:!this.state.editing})},componentWillReceiveProps:function(t){this.props.settings.editing!=t.settings.editing&&this.setState({editing:t.editing})},renderAdder:function(t){var e,r=this.props.settings.adder,s=typeof r;return e="function"==s?r(this.props.value.toJS()):r===!0||"undefined"==s?this.getDefaultAdder():r,n.createElement(i,{onCreate:this.createProperty,name:t,key:"add",text:e})},createProperty:function(t,e,r){if(this.props.value[t])return console.log("Property "+t+" already exists.");r.settings={editing:"always"==this.state.editing?"always":!0};var n=s({},this.state.properties);n[t]=r,this.setState({properties:n}),this.props.value.set(t,e)},checkEditingSetting:function(t){var e=this.state.properties;e[t]&&e[t].settings.editing===!0&&(e=s({},e),e[t].settings.editing=!1,this.setState({properties:e}))}}},function(t,e,r){"use strict";var n=r(1);t.exports={getStateFromProps:function(t){return{editing:t.settings.editing||!1,value:t.value}},renderInput:function(){var t=this.typeClass;return this.state.editing?n.DOM.input({type:this.inputType,value:this.state.value,placeholder:this.props.settings.placeholder||"",onChange:this.updateValue,onBlur:this.setValue,ref:"input",onKeyDown:this.handleKeyDown}):n.DOM.span({onClick:this.setEditMode,className:t},this.getDisplayString())},getDisplayString:function(){return this.getDisplayModeString?this.getDisplayModeString():this.props.value},componentWillReceiveProps:function(t){this.props.value!=t.value?this.setState({value:t.value}):this.props.settings.editing!=t.settings.editing&&this.setState({editing:t.editing})},componentDidUpdate:function(t,e){this.state.editing&&!e.editing&&this.focus()},componentDidMount:function(){this.state.editing&&this.focus()},setEditMode:function(){this.setState({editing:!0})},setValue:function(){"always"!=this.state.editing&&this.setState({editing:!1}),this.props.onUpdated(this.state.value)},toggleEditing:function(){this.setState({editing:!this.state.editing})},handleKeyDown:function(t){13==t.which&&this.setValue()},focus:function(){var t=this.refs.input.getDOMNode();t.focus(),t.value=t.value}}},function(t,e,r){"use strict";var n=r(19),i=r(20),s=(r(21),r(22)),o=function(t,e){var r,i=this,o=function(t,e,r){return"listener"==t?s.createListener(e):s.update(t,e,r)},a=function(){};e||(a=function(t){Object.freeze(t)}),r=s.freeze(t,o,a);var u=r.getListener(),p=!1;u.on("immediate",function(t,e){t==r&&(r=e,p||(p=!0,n.nextTick(function(){p=!1,i.trigger("update",r)})))}),n.addNE(this,{get:function(){return r},set:function(t){var e=o("reset",r,t);e.__.listener.trigger("immediate",r,e)}}),n.addNE(this,{getData:this.get,setData:this.set}),this._events=[]};o.prototype=n.createNonEnumerable({constructor:o},i),t.exports=o},function(t,e,r){"use strict";function n(t,e){return t.length?n(t.slice(1),e[t[0]]):e}var i={required:function(t){return t&&("string"!=typeof t||t.trim())?!0:!1},email:function(t){if(!t)return!0;var e=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},length:function(t,e,r,n){return r||(r=0),n||(n=1/0),t.length>=r&&t.length<=n},integer:function(t,e,r,n){if(r||0===r||(r=-(1/0)),n||(n=1/0),!t&&0!=t)return!0;var i=parseInt(t);return t!=i?!1:n>=i&&i>=r},checked:function(t){return t},matches:function(t,e,r){return t==n(r.split("."),e)}};t.exports={getValidationError:function(t,e,r){var n=[],a=!1,u=0;"string"==typeof r?n=s(r):"function"==typeof r?n=[r]:r&&r.constructor===Array&&(n=r);for(var p,c,h;!a&&u<n.length;)h=n[u++],"string"==typeof h?(p=o(h),c=i[p.name],c?c.apply(null,[t,e].concat(p.args))||(a={value:t,method:h}):console.log("Unkown validation method "+p.name)):"function"==typeof h&&(h(t,e)||(a={value:t,method:"custom"}));return a}};var s=function(t){return t.match(/[^\s\[]+(\[[^\]]+?\])?/gi)},o=function(t){var e,r=t.split("["),n={name:r[0],args:[]};return r.length>1&&(e=r[1],"]"==e[e.length-1]&&(e=e.slice(0,e.length-1)),n.args=e.split(/\s*,\s*/)),n}},function(t,e,r){var n=r(1),i=r(2),s=n.createClass({getInitialState:function(){return{creating:this.props.creating||!1,name:this.props.name,type:"string"}},render:function(){if(!this.state.creating)return n.DOM.a({className:"jsonAdd",href:"#",onClick:this.handleCreate},this.props.text);var t,e=this.getTypes().map(function(t){return n.DOM.option({value:t,key:t},t[0].toUpperCase()+t.slice(1))});return t="undefined"!=typeof this.props.name?[n.DOM.span({className:"jsonName"},this.props.name),n.DOM.span(null,":")]:[n.DOM.input({ref:"keyInput",type:"text",value:this.state.value,onChange:this.changeKey}),n.DOM.span(null,":")],n.DOM.div({className:"jsonProperty jsonPropertyAdder"},[t,n.DOM.select({key:"s",value:this.state.type,onChange:this.changeType,ref:"typeSelector"},e),n.DOM.button({key:"b",onClick:this.createProperty},"OK"),n.DOM.a({key:"a",href:"#",className:"cancelProperty",onClick:this.handleCancel},"Cancel")])},componentDidUpdate:function(t,e){!e.creating&&this.state.creating&&(this.refs.keyInput?this.refs.keyInput.getDOMNode().focus():this.refs.typeSelector.getDOMNode().focus())},componentWillReceiveProps:function(t){this.setState({name:t.name})},handleCreate:function(t){t.preventDefault(),this.setState({creating:!0})},handleCancel:function(t){t.preventDefault(),this.setState({creating:!1})},changeType:function(t){this.setState({type:t.target.value})},changeKey:function(t){this.setState({name:t.target.value})},createProperty:function(){this.setState({creating:!1});var t=i.prototype.components[this.state.type].prototype.defaultValue;this.props.onCreate(this.state.name,t,{type:this.state.type})},getTypes:function(){return Object.keys(i.prototype.components)}});t.exports=s},function(t,e,r){"use strict";var n=new Function("return this")(),i={extend:function(t,e){for(var r in e)t[r]=e[r];return t},createNonEnumerable:function(t,e){var r={};for(var n in t)r[n]={value:t[n]};return Object.create(e||{},r)},error:function(t){var e=new Error(t);if(console)return console.error(e);throw e},each:function(t,e){var r,n,i;if(t&&t.constructor==Array)for(r=0,n=t.length;n>r;r++)e(t[r],r);else for(i=Object.keys(t),r=0,n=i.length;n>r;r++)e(t[i[r]],i[r])},addNE:function(t,e){for(var r in e)Object.defineProperty(t,r,{enumerable:!1,configurable:!0,writable:!0,value:e[r]})},nextTick:function(){function t(){for(;r=i.shift();)r();s=!1}function e(t){i.push(t),s||(s=!0,u())}var r,i=[],s=!1,o=!!n.postMessage,a="nexttick",u=function(){return o?function(){n.postMessage(a,"*")}:function(){setTimeout(function(){p()},0)}}(),p=function(){return o?function(e){e.source===n&&e.data===a&&(e.stopPropagation(),t())}:t}();return o&&n.addEventListener("message",p,!0),e.removeListener=function(){n.removeEventListener("message",p,!0)},e}()};t.exports=i},function(t,e,r){"use strict";var n=r(19),i={on:function(t,e,r){var n=this._events[t]||[];return n.push({callback:e,once:r}),this._events[t]=n,this},once:function(t,e){this.on(t,e,!0)},off:function(t,e){if("undefined"==typeof t)this._events={};else if("undefined"==typeof e)this._events[t]=[];else{var r,n=this._events[t]||[];for(r=n.length-1;r>=0;r--)n[r]===e&&n.splice(r,1)}return this},trigger:function(t){var e,r,n=[].slice.call(arguments,1),i=this._events[t]||[],s=[];for(e=0;e<i.length;e++)r=i[e],r.callback?r.callback.apply(null,n):r.once=!0,r.once&&s.push(e);for(e=s.length-1;e>=0;e--)i.splice(s[e],1);return this}},s=n.createNonEnumerable(i);t.exports=s},function(t,e,r){"use strict";var n=r(19),i=function(t){var e={};for(var r in t)e[r]={writable:!0,configurable:!0,enumerable:!1,value:t[r]};return e},s={set:function(t,e){var r=t,n=this.__.trans;if("undefined"!=typeof e&&(r={},r[t]=e),!n){for(var i in r)n=n||this[i]!=r[i];if(!n)return this}return this.__.notify("merge",this,r)},reset:function(t){return this.__.notify("replace",this,t)},getListener:function(){return this.__.notify("listener",this)},toJS:function(){var t;return t=this.constructor==Array?new Array(this.length):{},n.each(this,function(e,r){t[r]=e&&e.__?e.toJS():e}),t},transact:function(){return this.__.notify("transact",this)},run:function(){return this.__.notify("run",this)}},o=n.extend({push:function(t){return this.append([t])},append:function(t){return t&&t.length?this.__.notify("splice",this,[this.length,0].concat(t)):this},pop:function(){return this.length?this.__.notify("splice",this,[this.length-1,1]):this},unshift:function(t){return this.prepend([t])},prepend:function(t){return t&&t.length?this.__.notify("splice",this,[0,0].concat(t)):this},shift:function(){return this.length?this.__.notify("splice",this,[0,1]):this},splice:function(t,e,r){return this.__.notify("splice",this,arguments)}},s),a=Object.create(Array.prototype,i(o)),u={Hash:Object.create(Object.prototype,i(n.extend({remove:function(t){var e=[],r=t;t.constructor!=Array&&(r=[t]);for(var n=0,i=r.length;i>n;n++)this.hasOwnProperty(r[n])&&e.push(r[n]);return e.length?this.__.notify("remove",this,e):this}},s))),List:a,arrayMethods:o};t.exports=u},function(t,e,r){"use strict";var n=r(19),i=r(21),s=r(20),o={freeze:function(t,e,r){if(t&&t.__)return t;var s,o,a=this;return s=t.constructor==Array?this.createArray(t.length):Object.create(i.Hash),n.addNE(s,{__:{listener:!1,parents:[],notify:e,dirty:!1,freezeFn:r}}),n.each(t,function(t,n){o=t&&t.constructor,(o==Array||o==Object)&&(t=a.freeze(t,e,r)),t&&t.__&&a.addParent(t,s),s[n]=t}),r(s),s},update:function(t,e,r){return this[t]?this[t](e,r):n.error("Unknown update type: "+t)},reset:function(t,e){var r,i=this;return e&&e.__?(r=e,r.__.listener=e.__.listener,r.__.parents=[],this.fixChildren(r,t),n.each(r,function(e){e&&e.__&&(i.removeParent(t),i.addParent(e,r))})):r=this.freeze(t,t.__.notify,t.__.freezeFn),r},merge:function(t,e){var r=t.__.trans,e=n.extend({},e);if(r){for(var i in e)r[i]=e[i];return t}var s,o,a,u,p=this,c=this.copyMeta(t),h=t.__.notify;n.each(t,function(r,n){return u=r&&r.__,u&&p.removeParent(r,t),(s=e[n])?(o=s&&s.constructor,(o==Array||o==Object)&&(s=p.freeze(s,h,t.__.freezeFn)),s&&s.__&&p.addParent(s,c),delete e[n],void(c[n]=s)):(u&&p.addParent(r,c),c[n]=r)});for(a in e)s=e[a],o=s&&s.constructor,(o==Array||o==Object)&&(s=p.freeze(s,h,t.__.freezeFn)),s&&s.__&&p.addParent(s,c),c[a]=s;return t.__.freezeFn(c),this.refreshParents(t,c),c},replace:function(t,e){var r=this,n=e&&e.constructor,i=t.__,s=e;(n==Array||n==Object)&&(s=r.freeze(e,i.notify,i.freezeFn),s.__.parents=i.parents,i.listener&&(s.__.listener=t.__.listener),s.__.listener&&this.trigger(s,"update",s)),!i.parents.length&&i.listener&&i.listener.trigger("immediate",t,s);for(var o=i.parents.length-1;o>=0;o--)0==o?this.refresh(i.parents[o],t,s,!1):this.markDirty(i.parents[o],[t,s]);return s},remove:function(t,e){var r=t.__.trans;if(r){for(var i=e.length-1;i>=0;i--)delete r[e[i]];return t}var s,o=this,a=this.copyMeta(t);return n.each(t,function(r,n){s=r&&r.__,s&&o.removeParent(r,t),-1==e.indexOf(n)&&(s&&o.addParent(r,a),a[n]=r)}),t.__.freezeFn(a),this.refreshParents(t,a),a},splice:function(t,e){var r=t.__.trans;if(r)return r.splice.apply(r,e),t;var i,s,o=this,a=this.copyMeta(t),u=e[0],p=u+e[1],c=t.__;if(n.each(t,function(e,r){e&&e.__&&(o.removeParent(e,t),(u>r||r>=p)&&o.addParent(e,a)),a[r]=e}),e.length>1)for(var h=e.length-1;h>=2;h--)s=e[h],i=s&&s.constructor,(i==Array||i==Object)&&(s=this.freeze(s,c.notify,c.freezeFn)),s&&s.__&&this.addParent(s,a),e[h]=s;return Array.prototype.splice.apply(a,e),t.__.freezeFn(a),this.refreshParents(t,a),a},transact:function(t){var e,r=this,i=t.__.trans;return i?i:(e=t.constructor==Array?[]:{},n.each(t,function(t,r){e[r]=t}),t.__.trans=e,n.nextTick(function(){t.__.trans&&r.run(t)}),e)},run:function(t){var e=this,r=t.__.trans;if(!r)return t;n.each(r,function(r,n){r&&r.__&&e.removeParent(r,t)}),delete t.__.trans;var i=this.replace(t,r);return i},refresh:function(t,e,r,i){var s=this,o=t.__.trans,a=0;if(o)return n.each(o,function(n,i){a||n===e&&(o[i]=r,a=1,r&&r.__&&s.addParent(r,t))}),t;var u,p,c,h=this.copyMeta(t),f=t.__.dirty;return f&&(u=f[0],p=f[1]),n.each(t,function(n,i){n===e?n=r:n===u&&(n=p),n&&(c=n.__)&&(!c.trans&&c.dirty&&(n=s.refresh(n,c.dirty[0],c.dirty[1],!0)),s.removeParent(n,t),s.addParent(n,h)),h[i]=n}),t.__.freezeFn(h),t.__.dirty=!1,i?h:void this.refreshParents(t,h)},fixChildren:function(t,e){var r=this;n.each(t,function(n){if(n&&n.__){if(-1!=n.__.parents.indexOf(t))return r.fixChildren(n);if(1==n.__.parents.length)return n.__.parents=[t];e&&r.removeParent(n,e),r.addParent(t)}})},copyMeta:function(t){var e;e=t.constructor==Array?this.createArray(t.length):Object.create(i.Hash);var r=t.__;return n.addNE(e,{__:{notify:r.notify,listener:r.listener,parents:r.parents.slice(0),trans:r.trans,dirty:!1,freezeFn:r.freezeFn}}),e},refreshParents:function(t,e){var r,n=t.__;if(n.listener&&this.trigger(e,"update",e),n.parents.length)for(r=n.parents.length-1;r>=0;r--)0==r?this.refresh(n.parents[r],t,e,!1):this.markDirty(n.parents[r],[t,e]);else n.listener&&n.listener.trigger("immediate",t,e)},markDirty:function(t,e){var r,n=t.__;for(n.dirty=e,n.trans&&this.refresh(t,e[0],e[1]),r=n.parents.length-1;r>=0;r--)this.markDirty(n.parents[r],e)},removeParent:function(t,e){var r=t.__.parents,n=r.indexOf(e);-1!=n&&r.splice(n,1)},addParent:function(t,e){var r=t.__.parents,n=r.indexOf(e);-1==n&&(r[r.length]=e)},trigger:function(t,e,r){var i=t.__.listener,s=i.ticking;i.ticking=r,s||n.nextTick(function(){var t=i.ticking;i.ticking=!1,i.trigger(e,t)})},createListener:function(t){var e=t.__.listener;return e||(e=Object.create(s,{_events:{value:{},writable:!0}}),t.__.listener=e),e},createArray:function(){return[].__proto__?function(t){var e=new Array(t);return e.__proto__=i.List,e}:function(t){var e=new Array(t),r=i.arrayMethods;for(var n in r)e[n]=r[n];return e}}()};t.exports=o}])});